var payurl = $(".js-domain").text();
var Setmealdata = {
    "converter": {
        "active": "4",
        "data": [{
            "btntext": "48元/1台电脑半年授权",
            "title": "迅捷PDF转换器 48元套餐",
            "text": "48元半年授权",
            "money": "48.00",
            "imgurl": payurl + "/images/dwon/zhq-1.jpg",
            "paypack": "BBC537C59F1F20EED15F40EABAF6A97BB35D5FCD03B2E274"
        }, {
            "btntext": "68元/1台电脑1年授权",
            "title": "迅捷PDF转换器 68元套餐 ",
            "text": "68元一年授权",
            "money": "68.00",
            "imgurl": payurl + "/images/dwon/zhq-1.jpg",
            "paypack": "5BC1D717A60C15CA69068C520BDA3CFEB4BAE59BD97C523A31E366AD5F21CFC0"
        }, {
            "btntext": "88元/1台电脑终身授权",
            "title": "迅捷PDF转换器 88元套餐",
            "text": "88元终身授权",
            "money": "88.00",
            "imgurl": payurl + "/images/dwon/zhq-1.jpg",
            "paypack": "EA8CDC12CAD6AE1C5600D2EB3C2E249F90802E3DAEB2D959332A46C425CC3E98"
        }, {
            "btntext": "118元超值套餐组合",
            "title": "迅捷PDF转换器 超值套餐 ",
            "text": "118元终身授权 + 迅捷PDF在线转换三年授权",
            "money": "118.00",
            "imgurl": payurl + "/images/dwon/zhq-1.jpg",
            "paypack": "89626BBF8DFD0A94D4AC2591D86ECE1907457E20D4D9402A0BF49B702FC8332872FEA7D461BFE67C2966E9C515C0064831E366AD5F21CFC0"
        }, {
            "btntext": "128元黄金套餐组合",
            "title": "迅捷PDF转换器 黄金套餐",
            "text": "128元终身授权 + 迅捷PDF编辑器终身授权 + 迅捷PDF在线转换三年授权(推荐)",
            "money": "128.00",
            "imgurl": payurl + "/images/dwon/zhq-1.jpg",
            "paypack": "472AA5972DF3CA9FDB436338B39E47BCA1F8C2964595C2A3C37D2C18AB07DBA2E4EE7C2B2256D040391A73EC353A37B94D4EFE40726D940D89AAB56BF22A851F"
        }]
    },
    "editor": {
        "active": "2",
        "data": [{
            "btntext": "88元/终身授权",
            "title": "迅捷PDF编辑器 88元套餐",
            "text": "迅捷PDF编辑器终身VIP",
            "money": "88.00",
            "imgurl": payurl + "/images/dwon/bjq-1.jpg",
            "paypack": "EA8CDC12CAD6AE1CC9182534E7AD45714725F6C13814D9BE"
        }, {
            "btntext": "128元超值套餐组合",
            "title": "迅捷PDF编辑器 超值套餐",
            "text": "迅捷PDF编辑器终身VIP + 迅捷PDF转换器终身VIP",
            "money": "128.00",
            "imgurl": payurl + "/images/dwon/bjq-1.jpg",
            "paypack": "472AA5972DF3CA9F1B0F64C8E6A6A2ABE4EE7C2B2256D04072898B72A906520EB4BAE59BD97C523A0330554B055737EA"
        }, {
            "btntext": "158元黄金套餐组合",
            "title": "迅捷PDF编辑器 黄金套餐",
            "text": "迅捷PDF编辑器终身VIP + 迅捷PDF转换器终身VIP + 捷速OCR文字识别软件终身VIP+迅 捷PDF在线转换3年VIP",
            "money": "158.00",
            "imgurl": payurl + "/images/dwon/bjq-1.jpg",
            "paypack": "18C6F1B9C459045392C1B3447BE52C7CD4AC2591D86ECE19830DBECD8EB6F154D15F40EABAF6A97B0D67B1DE2B4473CB92DE1AAFDC74AE7A72FEA7D461BFE67C2966E9C515C006480330554B055737EA"
        }]
    },
    "ocr": {
        "active": "2",
        "data": [{
            "btntext": "48元/半年授权",
            "title": "捷速OCR文字识别软件 48元套餐",
            "text": "48元半年授权",
            "money": "48.00",
            "imgurl": payurl + "/images/dwon/ocr-1.jpg",
            "paypack": "BBC537C59F1F20EE889369B5B605840731738CFCA35DE43D"
        }, {
            "btntext": "68元/1台电脑1年授权",
            "title": "捷速OCR文字识别软件 68 元套餐 ",
            "text": "68元一年授权",
            "money": "68.00",
            "imgurl": payurl + "/images/dwon/ocr-1.jpg",
            "paypack": "5BC1D717A60C15CA6764C165117E1DE8FF62328B2FEC3BD6"
        }, {
            "btntext": "88元/1台电脑终身授权",
            "title": "捷速OCR文字识别软件 88元套餐",
            "text": "88元终身授权",
            "money": "88.00",
            "imgurl": payurl + "/images/dwon/ocr-1.jpg",
            "paypack": "EA8CDC12CAD6AE1C4E1AD47EE2DFAB27EE0BF85FBD557474"
        }, {
            "btntext": "128元超值套餐组合",
            "title": "捷速OCR文字识别软件 超值套餐 ",
            "text": "128元ocr识别终身+PDF转换终身",
            "money": "128.00",
            "imgurl": payurl + "/images/dwon/ocr-1.jpg",
            "paypack": "472AA5972DF3CA9F277437B3007EF330F94E8F7470C6E721F827CF9C9C1F6AC6FF62328B2FEC3BD6"
        }, {
            "btntext": "158元黄金套餐组合",
            "title": "捷速OCR文字识别软件 黄金套餐",
            "text": "158元ocr终身+PDF编辑终身+PDF转换终身+PDF在线三年",
            "money": "158.00",
            "imgurl": payurl + "/images/dwon/ocr-1.jpg",
            "paypack": "18C6F1B9C459045392C1B3447BE52C7C1E87591ACC9B13C8B7AE03D3616A109579504E5FDB4C83C907457E20D4D9402A0BF49B702FC8332872FEA7D461BFE67C2966E9C515C0064831738CFCA35DE43D"
        }]
    },
    "printer": {
        "active": "2",
        "data": [{
            "btntext": "48元/一台电脑终身授权",
            "title": "迅捷PDF虚拟打印机 48元套餐",
            "text": "一台电脑终身授权",
            "money": "48.00",
            "imgurl": payurl + "/images/dwon/xlj-1.jpg",
            "paypack": "4E480DDD8CC3538FE9D63963ED1349A9313AE21603B31829"
        }, {
            "btntext": "88元/三台电脑终身授权",
            "title": "迅捷PDF虚拟打印机 88元套餐",
            "text": "三台电脑终身授权",
            "money": "88.00",
            "imgurl": payurl + "/images/dwon/xlj-1.jpg",
            "paypack": "EA8CDC12CAD6AE1CCB6F0309BB28B21AD5AE59E2CFFD26D2"
        }, {
            "btntext": "89元/超值套餐组合",
            "title": "迅捷PDF虚拟打印机 超值套餐",
            "text": "3台电脑终身授权 + 迅捷PDF转换器/1台电脑一年授权 + 迅捷PDF编辑器/1台电脑一年授权 + 捷速OCR文字识别软件/1台电脑一年授权",
            "money": "89.00",
            "imgurl": payurl + "/images/dwon/xlj-1.jpg",
            "paypack": "B1D1829B445A8CE6E3017AC4F89EBAC403C2629737A1B65267E19FD22676E5B4830DBECD8EB6F154D15F40EABAF6A97B0D67B1DE2B4473CB20CC83D090102E18"
        }]
    },
    "caj": {
        "active": "2",
        "data": [{
            "btntext": "48元/半年授权",
            "title": "迅捷转换器 48元套餐",
            "text": "迅捷转换器半年授权",
            "money": "48.00",
            "imgurl": payurl + "/images/dwon/caj-1.jpg",
            "paypack": "BBC537C59F1F20EED39EEFB573548E928EA07435A1C03DD6C5B28A1D8F2DE200"
        }, {
            "btntext": "68元/一年授权",
            "title": "迅捷转换器 68元套餐",
            "text": "迅捷转换器一年授权",
            "money": "68.00",
            "imgurl": payurl + "/images/dwon/caj-1.jpg",
            "paypack": "5BC1D717A60C15CA90B826BA676E64C3EF8DE49EDA1C370B32896121BD839541"
        }, {
            "btntext": "88元/终生授权",
            "title": "迅捷转换器 88元套餐",
            "text": "迅捷转换器终身授权",
            "money": "88.00",
            "imgurl": payurl + "/images/dwon/caj-1.jpg",
            "paypack": "EA8CDC12CAD6AE1C969F3B372D96A483280B3ACB8BF93B6D811276BBC892AC7F"
        }]
    }
}

function getpagename() {
    var url = window.location.href;
    var name = [
        "converter", "editor", "ocr", "printer", "caj"
    ];
    for (i in name) {
        var namereg = new RegExp(name[i]);
        if (namereg.test(url)) {
            return name[i];
        }
    }
}
$(function() {
    var pagename = getpagename();
    var btndom = "";
    var active = Setmealdata[pagename]["active"];
    for (i in Setmealdata[pagename]["data"]) {
        if (i == active) {
            btndom += '<a href="javascript:void(0)" data-paypack="' + Setmealdata[pagename]["data"][i]["paypack"] + '" data-index="' + i + '"  class="hot-Setmeal active"><i></i><span>' + Setmealdata[pagename]["data"][i]["btntext"] + '</span><em></em></a>';
        } else {
            btndom += '<a href="javascript:void(0)" data-paypack="' + Setmealdata[pagename]["data"][i]["paypack"] + '"data-index="' + i + '"><span>' + Setmealdata[pagename]["data"][i]["btntext"] + '</span><em></em></a>';
        }
    }
    var taocandom = '<div class="buy-img">' +
        '<img class="js-setmeal-img" src="' + Setmealdata[pagename]["data"][active]["imgurl"] + '" alt="">' +
        '</div>' +
        '<div class="buy-text">' +
        '<h6 class="js-title">' + Setmealdata[pagename]["data"][active]["title"] + '</h6>' +
        '<p class="buy-text-p js-text">' + Setmealdata[pagename]["data"][active]["text"] + '</p>' +
        '<p class="buy-text-p1"><span>¥</span><em class="js-money">' + Setmealdata[pagename]["data"][active]["money"] + '</em></p>' +
        '<div class="buy-slt-box js-setmeal-box">' + btndom +
        '</div>' +
        '</div>';
    $(".js-taocan-box").html(taocandom);
    $(document).on("click", ".js-setmeal-box>a", function() {
        if (!$(this).hasClass("active")) {
            var index = $(this).attr("data-index");
            $(".js-setmeal-img").attr("src", Setmealdata[pagename]["data"][index]["imgurl"]);
            $(".js-title").text(Setmealdata[pagename]["data"][index]["title"]);
            $(".js-text").text(Setmealdata[pagename]["data"][index]["text"]);
            $(".js-money").text(Setmealdata[pagename]["data"][index]["money"]);
            $(this).siblings("a").removeClass("active");
            $(this).addClass("active");
        }
    })

    $(document).on("click", ".js-buy-btn", function() {
        var account = $(".js-tel-ipt").val();
        if (!checkPhone(account)) {
            $(".js-tel-ipt").addClass("bd-red");
            return false;
        }
        var paymethod = $(".js-pay-mode>a.active").attr("data-paytype");
        var truename = $(".js-name-ipt").val();
        var softversion = "v1.0.0";
        var timestamp = Math.round(new Date().getTime() / 1000);
        var noticeurl = '';
        var paypack = $(".js-setmeal-box>a.active").attr("data-paypack");
        var datasign = $.md5("account=" + account + "&noticeurl=" + noticeurl + "&paymethod=" + paymethod + "&paypack=" + paypack + "&softversion=" + "v1.0" + "&timestamp=" + timestamp + "&truename=" + truename + "hUuPd20171206LuOnD");
        var payjson = { "account": account, "noticeurl": noticeurl, "paymethod": paymethod, "paypack": paypack, "softversion": "v1.0", "timestamp": timestamp, "truename": truename, "datasign": datasign };
        $.ajax({
            url: "http://app.xunjiepdf.com/api/v4/buypaypack",
            type: "POST",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            data: JSON.stringify(payjson),
            async: false,
            success: function(data) {
                console.log(data);
                if (paymethod == "weixinpay") {
                    var formData = new FormData();
                    formData.append("iflogo", "1");
                    formData.append("totype", "base64");
                    formData.append("width", "150");
                    formData.append("url", data.message);
                    $.ajax({
                        url: "http://app.xunjiepdf.com/api/urlCQRcode",
                        type: "POST",
                        dataType: "json",
                        contentType: false, // 告诉jQuery不要去设置Content-Type请求头
                        processData: false, // 告诉jQuery不要去处理发送的数据
                        data: formData,
                        async: false,
                        success: function(data) {
                            $(".js-pay-qr").attr("src", data.message);
                            $(".js-money-nub").text("￥" + $(".js-money").text() + "元");
                            $(".pop-mask").show();
                            $(".WeChat-payment-pop").show();
                        }
                    });
                } else if (paymethod == "alipay") {
                    window.open(data.message);
                }
            }
        });
    })

    $(document).on("click", ".js-pay-mode>a", function() {
        if (!$(this).hasClass("active")) {
            $(this).siblings("a").removeClass("active");
            $(this).addClass("active");
        }
    })

    $(".js-wechat-close").click(function() {
        $(".pop-mask,.WeChat-payment-pop").hide();
    })

    $(".js-tel-ipt").change(function() {
        var telnub = $(this).val();
        $(this).val(telnub.slice(0, 11));
        $(".js-tel-ipt").removeClass("bd-red");
    })
})



function checkPhone(phone) {
    if (!(/^1[34578]\d{9}$/.test(phone))) {
        return false;
    } else {
        return true;
    }
}